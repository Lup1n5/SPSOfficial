import{initializeApp as B}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";import{getDatabase as $,ref as o,set as m,get as f,onValue as A}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";import{getAuth as x,GoogleAuthProvider as D,onAuthStateChanged as O,signInWithEmailAndPassword as k,signOut as M}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const y of n.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&i(y)}).observe(document,{childList:!0,subtree:!0});function r(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=r(e);fetch(e.href,n)}})();const C={apiKey:"AIzaSyAYjLbsdGgVccTHa_bpEaDh7orYmzldiMk",authDomain:"stewflandic-permission-system.firebaseapp.com",databaseURL:"https://stewflandic-permission-system-default-rtdb.firebaseio.com",projectId:"stewflandic-permission-system",storageBucket:"stewflandic-permission-system.firebasestorage.app",messagingSenderId:"1035943934052",appId:"1:1035943934052:web:d3b8c6802c9a99ec81c771"},P=B(C),v=x();new D;const a=$(P),b=document.getElementById("logged-in-view"),S=document.getElementById("logged-out-view"),T=document.getElementById("user-email"),E=document.getElementById("signin-email-input"),h=document.getElementById("signin-password-input");document.getElementById("signup-email-input");document.getElementById("signup-password-input");const w=document.getElementById("sign-in-btn"),U=document.getElementById("logout-button"),l=document.querySelector(".chat-messages");document.querySelector(".chat-input-form");const d=document.querySelector(".chat-input"),L=document.querySelector(".send-button");var c="",g="";let u="";function I(){let t=new Date().toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),s={sender:"Server",text:`${c} has disconnected.`,timestamp:t};const r=o(a,`messages/${u}`);m(r,s);const i=o(a,`users/${u}`);m(i,null);for(var e=0;e<l.childElementCount;e++)l.removeChild(l.firstChild),M(v).then(()=>{}).catch(n=>{})}document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&I()});O(v,t=>{if(t){u=t.uid,g=t.email,b.style.display="block",T.innerText=g,E.value="",h.value="",S.style.display="none",c=g;const s=o(a,`users/${u}`);let r=new Date().toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),i={sender:"Server",text:`${c} has connected.`,timestamp:r};const e=o(a,`messages/${u}`);m(e,i),m(s,g)}else b.style.display="none",S.style.display="block"});w.addEventListener("click",()=>{k(v,E.value,h.value).then(t=>{t.user}).catch(t=>{t.code,t.message,h.value=""})});h.addEventListener("keypress",function(t){t.key==="Enter"&&(t.preventDefault(),w.click())});U.addEventListener("click",()=>{I()});const p=t=>{const s=document.createElement("div");let i=new Date().toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}).replace(/[:APM]/g,""),e=t.timestamp.replace(/[:APM]/g,"");Math.abs(Number(e)-Number(i))<2&&(s.innerHTML=`<div class="message ${t.sender===c?"blue-bg":t.text.includes("@"+c.replace("@providenceday.org",""))==!0?"yello-bg":"gray-bg"}">
  <div class="message-sender">${t.timestamp}:          ${t.sender}</div>
  <div class="message-text">${t.text}</div>
  </div>`,l.appendChild(s),l.scrollTop=l.scrollHeight)};L.addEventListener("click",()=>{if(d.value!="-tablist"){let s=new Date().toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),r={sender:c,text:d.value,timestamp:s};if(r.text){const i=o(a,`messages/${u}`);m(i,r);const e=o(a,"messageCount");f(e).then(n=>{m(e,n.val()+1)}),p(r),d.value=""}}else{var t=!1;const s=o(a,"users");f(s).then(r=>{if(Object.values(r.val()).forEach(i=>{let e=new Date().toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),n={sender:"TABLIST",text:`${i} is online.`,timestamp:e};i!=c&&(p(n),t=!0)}),t==!1){let e={sender:"TABLIST",text:"Nobody is online.",timestamp:new Date().toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})};p(e)}}),d.value=""}});d.addEventListener("keypress",function(t){t.key==="Enter"&&(t.preventDefault(),L.click())});const N=o(a,"messages");f(N).then(t=>{Object.keys(t.val()).forEach(s=>{const r=o(a,`messages/${s}/text`);A(r,()=>{const i=o(a,`messages/${s}`);f(i).then(e=>{let n=e.val();n.sender!=c&&p(n)})})})});
